### 404 Not found for files in public folder

Next.js supports static file serving by [placing files into a public/ folder](https://nextjs.org/docs/basic-features/static-file-serving). This is useful for files such as `favicon.ico`. This module by default provides support for `favicon.ico` files but if you want to add other files, these may not be captured by the [CloudFront behaviours configured in Terraform](https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/cloudfront_distribution#cache-behavior-arguments).

Next.js may try to resolve these files as dynamic paths, which may result in the files not being found. To fix this, go into `infra/aws/root.tf` and add additional `ordered_cache_behaviours` as required.

For instance, if you want to serve a file `/myfile.png` provided in `public/myfile.png` and this file should be cached in CloudFront, add the following behaviour:

```hcl
  ordered_cache_behavior {
    path_pattern     = "myfile.png"
    allowed_methods  = ["GET", "HEAD", "OPTIONS"]
    cached_methods   = ["GET", "HEAD", "OPTIONS"]
    target_origin_id = "origin-bucket-${aws_s3_bucket.website_root.id}"

    forwarded_values {
      query_string = false
      headers      = ["Origin"]

      cookies {
        forward = "none"
      }
    }

    min_ttl                = 0
    default_ttl            = 86400
    max_ttl                = 31536000
    compress               = true
    viewer_protocol_policy = "redirect-to-https"
  }
```

If you would like all files in `/myfolder` provided in the folder `public/myfolder` and not cache these, provide the following behaviour:

```hcl
  ordered_cache_behavior {
    path_pattern     = "myfolder/*"
    allowed_methods  = ["GET", "HEAD", "OPTIONS"]
    cached_methods   = ["GET", "HEAD", "OPTIONS"]
    target_origin_id = "origin-bucket-${aws_s3_bucket.website_root.id}"

    forwarded_values {
      query_string = false
      headers      = ["Origin"]

      cookies {
        forward = "none"
      }
    }

    min_ttl                = 0
    default_ttl            = tostring(var.default_cache_duration)
    max_ttl                = 1200
    compress               = true
    viewer_protocol_policy = "redirect-to-https"
  }
```

### '502 ERROR The request could not be satisfied' when opening page

Instead of seeing the page, you may see an error message like the following:

```bash
502 ERROR
The request could not be satisfied.
The Lambda function returned invalid json: The json output must be an object type. We can't connect to the server for this app or website at this time. There might be too much traffic or a configuration error. Try again later, or contact the app or website owner.
If you provide content to customers through CloudFront, you can find steps to troubleshoot and help prevent this error by reviewing the CloudFront documentation.
Generated by cloudfront (CloudFront)
Request ID: JIQQuxOxsXdcyHuUKxbA88YeFs_NH0h7B6xbG-SZFN88byb5WffF0A==
```

This is most likely due to the deployment not having worked correctly. Try deploying the package again with `yarn deploy [deploymentName]`.

[!embed](./../shared/faq-access-denied.md)

### Error deleting Lambda Function

Sometimes when running `yarn infra destroy [deploymentName]` Terraform reports an error that the edge lambda cannot be deleted.

```
Error: Error deleting Lambda Function: InvalidParameterValueException: Lambda was unable to delete arn:aws:lambda:us-east-1:475629728374:function:[function name]-edge:2 because it is a replicated function. Please see our documentation for Deleting Lambda@Edge Functions and Replicas
```

In that case, simply run `yarn infra destroy [deploymentName]` again until it is successful.

### Error: error creating CloudFront Distribution: AccessDenied

When standing up the infrastructure, the following error may be displayed:

```
Error: error creating CloudFront Distribution: AccessDenied: Your account must be verified before you can add
new CloudFront resources. To verify your account, please contact AWS Support (https://console.aws.amazon.com/support/home#/) and include this error message.
│       status code: 403, request id: xxx
│
│   with aws_cloudfront_distribution.website_cdn_root,
│   on root.tf line 45, in resource "aws_cloudfront_distribution" "website_cdn_root":
│   45: resource "aws_cloudfront_distribution" "website_cdn_root" {
```

This must be resolved by raising a request with AWS as follows:

- Create a new [Service Limit Increase Case](https://us-east-1.console.aws.amazon.com/support/home#/case/create?issueType=service-limit-increase)
  - _Limit Type_: choose `CloudFront Distributions`
  - _Distribution Id_: leave empty
  - _Limit_: choose `Web Distributions per Account`
- Wait for a few hours until your request is approved
