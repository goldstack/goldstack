name: Agent Comment Handler

on:
  issue_comment:
    types: [created]

jobs:
  run-agent:
    if: contains(github.event.comment.body, 'run') && startsWith(github.event.issue.title, 'Agent:') && (github.event.comment.user.login == 'mxro' || github.event.comment.user.login == 'goldstack')
    name: Run Agent for Comment by authorized user
    runs-on: ubuntu-latest
    timeout-minutes: 45

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.PAT_TOKEN }}
          fetch-depth: 1

      - uses: ./.github/actions/ai-agent
        with:
          issue_number: ${{ github.event.issue.number }}
          github_token: ${{ secrets.PAT_TOKEN }}
          openrouter_api_key: ${{ secrets.OPENROUTER_API_KEY }}
